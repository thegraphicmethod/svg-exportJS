function t(t,i){(null==i||i>t.length)&&(i=t.length);for(var o=0,e=Array(i);o<i;o++)e[o]=t[o];return e}function i(i,o){var e="undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(e)return(e=e.call(i)).next.bind(e);if(Array.isArray(i)||(e=function(i,o){if(i){if("string"==typeof i)return t(i,o);var e={}.toString.call(i).slice(8,-1);return"Object"===e&&i.constructor&&(e=i.constructor.name),"Map"===e||"Set"===e?Array.from(i):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(i,o):void 0}}(i))||o&&i&&"number"==typeof i.length){e&&(i=e);var n=0;return function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=/*#__PURE__*/function(){function t(t){void 0===t&&(t={}),this.version="1.2.0",this._options={},this._canvg=t.canvg,this._pdfkit=t.pdfkit,this._svgToPdf=t.svgToPdf,this._blobStream=t.blobStream,this._presets=t.presets,this._textToPath=t.textToPath,this._hasCanvg=void 0!==this._canvg,this._hasPDF=void 0!==this._pdfkit&&void 0!==this._svgToPdf&&void 0!==this._blobStream,this._hasTextToPath=void 0!==this._textToPath}var o=t.prototype;return o.setDependencies=function(t){this._canvg=t.canvg,this._pdfkit=t.pdfkit,this._svgToPdf=t.svgToPdf,this._blobStream=t.blobStream,this._textToPath=t.textToPath,this._hasCanvg=void 0!==this._canvg,this._hasTextToPath=void 0!==this._textToPath,this._hasPDF=void 0!==this._pdfkit&&void 0!==this._svgToPdf&&void 0!==this._blobStream},o._warnError=function(t){void 0!==typeof console&&"function"==typeof console.warn&&console.warn(t)},o._getSvgElement=function(t){var i=document.createElement("div");if(i.className="tempdiv-svg-exportJS","string"==typeof t&&(i.insertAdjacentHTML("beforeend",t.trim()),t=i.firstChild),!t.nodeType||1!==t.nodeType)return this._warnError("Error svg-export: The input svg was not recognized"),null;var o=t.cloneNode(!0);return o.style.display=null,i.appendChild(o),i.style.visibility="hidden",i.style.display="table",i.style.position="absolute",document.body.appendChild(i),o},o._setPdfOptions=function(t){var i=this;t&&t.pdfOptions&&(Object.keys(this._options.pdfOptions).forEach(function(o){if(t.pdfOptions.hasOwnProperty(o)&&typeof t.pdfOptions[o]==typeof i._options.pdfOptions[o]){if(""===t.pdfOptions[o])return;i._options.pdfOptions[o]=t.pdfOptions[o]}}),this._options.pdfOptions.pageLayout.margin||(this._options.pdfOptions.pageLayout.margin=50),this._options.pdfOptions.pageLayout.margins||(this._options.pdfOptions.pageLayout.margins={})),this._options.pdfOptions.pageLayout.margins.top=this._options.pdfOptions.pageLayout.margins.top||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.bottom=this._options.pdfOptions.pageLayout.margins.bottom||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.left=this._options.pdfOptions.pageLayout.margins.left||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.right=this._options.pdfOptions.pageLayout.margins.top||this._options.pdfOptions.pageLayout.margin,delete this._options.pdfOptions.pageLayout.margin,t&&this._options.pdfOptions.pageLayout.size||(this._options.pdfOptions.pageLayout.size=[Math.max(300,this._options.width)+this._options.pdfOptions.pageLayout.margins.left+this._options.pdfOptions.pageLayout.margins.right,Math.max(300,this._options.height)+this._options.pdfOptions.pageLayout.margins.top+this._options.pdfOptions.pageLayout.margins.bottom+(this._options.pdfOptions.addTitleToPage?2*this._options.pdfOptions.pdfTitleFontSize+10:0)+(""!==this._options.pdfOptions.chartCaption?4*this._options.pdfOptions.pdfCaptionFontSize+10:0)])},o._setOptions=function(t,i){this._options={originalWidth:100,originalHeight:100,originalMinXViewBox:0,originalMinYViewBox:0,originalWidthViewbox:100,originalHeightViewbox:100,width:100,height:100,scale:1,useCSS:!0,transparentBackgroundReplace:"white",allowCrossOriginImages:!1,elementsToExclude:[],convertTextToPath:!1,svgTextToPathSettings:{fonts:[]},pdfOptions:{customFonts:[],pageLayout:{margin:50,margins:{}},addTitleToPage:!0,chartCaption:"",pdfTextFontFamily:"Helvetica",pdfTitleFontSize:20,pdfCaptionFontSize:14},onDone:null},i&&i.originalHeight&&i.originalWidth?(this._options.originalHeight=i.originalHeight,this._options.originalWidth=i.originalWidth):(this._options.originalHeight=-1!==t.style.getPropertyValue("height").indexOf("%")||t.getAttribute("height")&&-1!==t.getAttribute("height").indexOf("%")?t.getBBox().height:t.getBoundingClientRect().height,this._options.originalWidth=-1!==t.style.getPropertyValue("width").indexOf("%")||t.getAttribute("width")&&-1!==t.getAttribute("width").indexOf("%")?t.getBBox().width:t.getBoundingClientRect().width);var o=t.getAttribute("viewBox");if(o){var e,n,s,a,r=o.split(/[\s,]+/);this._options.originalMinXViewBox=null!=(e=r[0])?e:0,this._options.originalMinYViewBox=null!=(n=r[1])?n:0,this._options.originalWidthViewbox=null!=(s=r[2])?s:100,this._options.originalHeightViewbox=null!=(a=r[3])?a:100}else this._options.originalMinXViewBox=0,this._options.originalMinYViewBox=0,this._options.originalWidthViewbox=NaN,this._options.originalHeightViewbox=NaN;i&&i.scale&&"number"==typeof i.scale&&(this._options.scale=i.scale),i&&i.height?"number"==typeof i.height&&(this._options.height=i.height*this._options.scale):this._options.height=this._options.originalHeight*this._options.scale,i&&i.width?"number"==typeof i.width&&(this._options.width=i.width*this._options.scale):this._options.width=this._options.originalWidth*this._options.scale,i&&!1===i.useCSS&&(this._options.useCSS=!1),i&&i.transparentBackgroundReplace&&(this._options.transparentBackgroundReplace=i.transparentBackgroundReplace),i&&i.allowCrossOriginImages&&(this._options.allowCrossOriginImages=i.allowCrossOriginImages),i&&i.excludeByCSSSelector&&"string"==typeof i.excludeByCSSSelector&&(this._options.elementsToExclude=t.querySelectorAll(i.excludeByCSSSelector)),i&&i.onDone&&"function"==typeof i.onDone&&(this._options.onDone=i.onDone),i&&i.svgTextToPathSettings&&(this._options.svgTextToPathSettings=i.svgTextToPathSettings),i&&i.convertTextToPath&&(this._options.convertTextToPath=i.convertTextToPath),this._setPdfOptions(i)},o.useCSSfromComputedStyles=function(t,o){var e=this;if("function"==typeof getComputedStyle){for(var n=0;n<this._options.elementsToExclude.length;n++)if(this._options.elementsToExclude[n]===o)return;var s=window.getComputedStyle(t);if(s.length>0)for(var a,r=i(s);!(a=r()).done;){var p=a.value;-1===["width","height","inline-size","block-size"].indexOf(p)&&o.style.setProperty(p,s.getPropertyValue(p))}t.childNodes.forEach(function(t,i){1===t.nodeType&&e.useCSSfromComputedStyles(t,o.childNodes[parseInt(i,10)])})}else this._warnError("Warning svg-export: this browser is not able to get computed styles")},o.setupSvg=function(t,i,o){void 0===o&&(o=!0),this._options.useCSS&&"object"==typeof i&&(this.useCSSfromComputedStyles(i,t),t.style.display=null),this._options.elementsToExclude.forEach(function(t){t.remove()}),t.style.width=null,t.style.height=null,t.setAttribute("width",this._options.width),t.setAttribute("height",this._options.height),t.setAttribute("preserveAspectRatio","none"),t.setAttribute("viewBox",this._options.originalMinXViewBox+" "+this._options.originalMinYViewBox+" "+(isNaN(this._options.originalWidthViewbox)?this._options.originalWidth:this._options.originalWidthViewbox)+" "+(isNaN(this._options.originalHeightViewbox)?this._options.originalHeight:this._options.originalHeightViewbox));for(var e=document.getElementsByClassName("tempdiv-svg-exportJS");e.length>0;)e[0].parentNode.removeChild(e[0]);if(o){var n=(new XMLSerializer).serializeToString(t).replace(/currentColor/g,"black");return n.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(n=n.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),n.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(n=n.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),n}return t},o.convertImageURLtoDataURI=function(t){var i=this;return new Promise(function(o,e){var n=new Image;n.onload=function(){var i=document.createElement("canvas");i.width=n.naturalWidth||n.getAttribute("width")||n.style.getPropertyValue("width")||300,i.height=n.naturalHeight||n.getAttribute("height")||n.style.getPropertyValue("height")||300,i.getContext("2d").drawImage(n,0,0);var e=i.toDataURL("image/png");t.setAttribute("href",e),o()},i._options.allowCrossOriginImages&&(n.crossOrigin="anonymous"),n.src=t.getAttribute("href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")})},o.getCustomFonts=function(t){var i=[];return t.forEach(function(t){var o=new Promise(function(i,o){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&i(e.response)},e.open("GET",t,!0),e.responseType="arraybuffer",e.send(null)});i.push(o)}),i},o.triggerDownload=function(t,i,o){if(i=i.replace(/[/\\?%*:|"<>]/g,"_"),navigator.msSaveBlob){for(var e=decodeURIComponent(t.split(",")[1]),n=[],s=t.split(",")[0].split(":")[1].split(";")[0],a=0;a<e.length;a++)n.push(e.charCodeAt(a));var r;r=null!=o?o.msToBlob():new Blob([new Uint8Array(n)],{type:s}),navigator.msSaveBlob(r,i)}else{var p=document.createElement("a");p.download=i,p.href=t,document.body.appendChild(p),p.click(),document.body.removeChild(p)}this._options.onDone&&this._options.onDone()},o.downloadSvg=function(t,o,e){var n=this;null==o&&(o="chart");var s=function(){var s=n._getSvgElement(t);if(s){n._setOptions(s,e);var a=s.getElementsByTagName("image"),r=[];if(a)for(var p,h=i(a);!(p=h()).done;){var g=p.value;(g.getAttribute("href")&&-1===g.getAttribute("href").indexOf("data:")||g.getAttribute("xlink:href")&&-1===g.getAttribute("xlink:href").indexOf("data:"))&&r.push(n.convertImageURLtoDataURI(g))}Promise.all(r).then(function(){var i=n.setupSvg(s,t);i='<?xml version="1.0" standalone="no"?>\r\n'+i;var e="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i);n.triggerDownload(e,o+".svg")})}};if(e.convertTextToPath){var a=new this._textToPath(t,e.svgTextToPathSettings);a.replaceAll().then(function(){s(),a.destroy()})}else s()},o.downloadRaster=function(t,i,o,e){try{var n=this;if(!n._hasCanvg)return n._warnError("Error svg-export: PNG/JPEG export requires Canvg. Install it via npm or include it via script tag."),Promise.resolve();"png"!==(e=e.toLowerCase().replace("jpg","jpeg"))&&"jpeg"!==e&&(e="png");var s=n._getSvgElement(t);if(!s)return Promise.resolve();null==i&&(i="chart"),o||(o={}),n._setOptions(s,o);var a=n.setupSvg(s,t);"jpeg"===e&&(a=a.replace(">",'><rect x="0" y="0" width="'+n._options.width+'" height="'+n._options.height+'" fill="'+n._options.transparentBackgroundReplace+'"/>')),a=n.removeBreakingStyles(a);var r=new OffscreenCanvas(n._options.width,n._options.height),p=n._presets.offscreen();p.anonymousCrossOrigin=n._options.allowCrossOriginImages;var h=r.getContext("2d"),g=n._canvg.fromString(h,a,p);return g.start(),g.ready().then(function(){r.convertToBlob({type:"jpeg"===e?"image/jpeg":"image/png"}).then(function(t){var o=URL.createObjectURL(t);n.triggerDownload(o,i+"."+e,r)})}),Promise.resolve()}catch(t){return Promise.reject(t)}},o.removeBreakingStyles=function(t){return t.replace(/mask: none; mask-type: luminance;/g,"")},o.downloadPng=function(t,i,o){this.downloadRaster(t,i,o,"png")},o.downloadJpeg=function(t,i,o){this.downloadRaster(t,i,o,"jpeg")},o.fillPDFDoc=function(t,i,o){this._options.pdfOptions.addTitleToPage&&t.font(this._options.pdfOptions.pdfTextFontFamily).fontSize(this._options.pdfOptions.pdfTitleFontSize).text(i,{width:this._options.pdfOptions.pageLayout.size[0]-this._options.pdfOptions.pageLayout.margins.left-this._options.pdfOptions.pageLayout.margins.right}),this._svgToPdf(t,o,this._options.pdfOptions.pageLayout.margins.left,t.y+10,{width:this._options.width,height:this._options.height,preserveAspectRatio:"none",useCSS:this._options.useCSS}),""!==this._options.pdfOptions.chartCaption&&t.font(this._options.pdfOptions.pdfTextFontFamily).fontSize(this._options.pdfOptions.pdfCaptionFontSize).text(this._options.pdfOptions.chartCaption,this._options.pdfOptions.pageLayout.margins.left,this._options.pdfOptions.pageLayout.size[1]-this._options.pdfOptions.pageLayout.margins.bottom-4*this._options.pdfOptions.pdfCaptionFontSize,{width:this._options.pdfOptions.pageLayout.size[0]-this._options.pdfOptions.pageLayout.margins.left-this._options.pdfOptions.pageLayout.margins.right})},o.downloadPdf=function(t,o,e){var n=this;if(this._hasPDF){var s=this._getSvgElement(t);if(s){null==o&&(o="chart"),this._setOptions(s,e);var a=this.setupSvg(s,t,!1),r=new this._pdfkit(this._options.pdfOptions.pageLayout),p=r.pipe(this._blobStream()),h=s.getElementsByTagName("image"),g=[];if(h)for(var l,d=i(h);!(l=d()).done;){var f=l.value;(f.getAttribute("href")&&-1===f.getAttribute("href").indexOf("data:")||f.getAttribute("xlink:href")&&-1===f.getAttribute("xlink:href").indexOf("data:"))&&g.push(this.convertImageURLtoDataURI(f))}Promise.all(g).then(function(){if(n._options.pdfOptions.customFonts.length>0){var t=n.getCustomFonts(n._options.pdfOptions.customFonts.map(function(t){return t.url}));Promise.all(t).then(function(t){t.forEach(function(t,i){var o=n._options.pdfOptions.customFonts[parseInt(i,10)];a.querySelectorAll('[style*="'+o.fontName+'"]').forEach(function(t){t.style.fontFamily=o.fontName}),-1===o.url.indexOf(".ttc")&&-1===o.url.indexOf(".dfont")||!o.styleName?r.registerFont(o.fontName,t):r.registerFont(o.fontName,t,o.styleName)}),n.fillPDFDoc(r,o,a),r.end()})}else n.fillPDFDoc(r,o,a),r.end()}),p.on("finish",function(){var t=p.toBlobURL("application/pdf");n.triggerDownload(t,o+".pdf")})}}else this._warnError("Error svg-export: PDF export requires PDFKit, blob-stream and SVG-to-PDFKit.")},t}();"object"==typeof exports&&"undefined"!=typeof module?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):("undefined"!=typeof globalThis?globalThis:self).SvgExport=o;export{o as default};
//# sourceMappingURL=svg-export.module.js.map
