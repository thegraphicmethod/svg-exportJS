class t{constructor(t={}){this.version="1.2.0",this._options={},this._canvg=t.canvg,this._pdfkit=t.pdfkit,this._svgToPdf=t.svgToPdf,this._blobStream=t.blobStream,this._presets=t.presets,this._textToPath=t.textToPath,this._hasCanvg=void 0!==this._canvg,this._hasPDF=void 0!==this._pdfkit&&void 0!==this._svgToPdf&&void 0!==this._blobStream,this._hasTextToPath=void 0!==this._textToPath}setDependencies(t){this._canvg=t.canvg,this._pdfkit=t.pdfkit,this._svgToPdf=t.svgToPdf,this._blobStream=t.blobStream,this._textToPath=t.textToPath,this._hasCanvg=void 0!==this._canvg,this._hasTextToPath=void 0!==this._textToPath,this._hasPDF=void 0!==this._pdfkit&&void 0!==this._svgToPdf&&void 0!==this._blobStream}_warnError(t){void 0!==typeof console&&"function"==typeof console.warn&&console.warn(t)}_getSvgElement(t){let i=document.createElement("div");if(i.className="tempdiv-svg-exportJS","string"==typeof t&&(i.insertAdjacentHTML("beforeend",t.trim()),t=i.firstChild),!t.nodeType||1!==t.nodeType)return this._warnError("Error svg-export: The input svg was not recognized"),null;let o=t.cloneNode(!0);return o.style.display=null,i.appendChild(o),i.style.visibility="hidden",i.style.display="table",i.style.position="absolute",document.body.appendChild(i),o}_setPdfOptions(t){t&&t.pdfOptions&&(Object.keys(this._options.pdfOptions).forEach(i=>{if(t.pdfOptions.hasOwnProperty(i)&&typeof t.pdfOptions[i]==typeof this._options.pdfOptions[i]){if(""===t.pdfOptions[i])return;this._options.pdfOptions[i]=t.pdfOptions[i]}}),this._options.pdfOptions.pageLayout.margin||(this._options.pdfOptions.pageLayout.margin=50),this._options.pdfOptions.pageLayout.margins||(this._options.pdfOptions.pageLayout.margins={})),this._options.pdfOptions.pageLayout.margins.top=this._options.pdfOptions.pageLayout.margins.top||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.bottom=this._options.pdfOptions.pageLayout.margins.bottom||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.left=this._options.pdfOptions.pageLayout.margins.left||this._options.pdfOptions.pageLayout.margin,this._options.pdfOptions.pageLayout.margins.right=this._options.pdfOptions.pageLayout.margins.top||this._options.pdfOptions.pageLayout.margin,delete this._options.pdfOptions.pageLayout.margin,t&&this._options.pdfOptions.pageLayout.size||(this._options.pdfOptions.pageLayout.size=[Math.max(300,this._options.width)+this._options.pdfOptions.pageLayout.margins.left+this._options.pdfOptions.pageLayout.margins.right,Math.max(300,this._options.height)+this._options.pdfOptions.pageLayout.margins.top+this._options.pdfOptions.pageLayout.margins.bottom+(this._options.pdfOptions.addTitleToPage?2*this._options.pdfOptions.pdfTitleFontSize+10:0)+(""!==this._options.pdfOptions.chartCaption?4*this._options.pdfOptions.pdfCaptionFontSize+10:0)])}_setOptions(t,i){this._options={originalWidth:100,originalHeight:100,originalMinXViewBox:0,originalMinYViewBox:0,originalWidthViewbox:100,originalHeightViewbox:100,width:100,height:100,scale:1,useCSS:!0,transparentBackgroundReplace:"white",allowCrossOriginImages:!1,elementsToExclude:[],convertTextToPath:!1,svgTextToPathSettings:{fonts:[]},pdfOptions:{customFonts:[],pageLayout:{margin:50,margins:{}},addTitleToPage:!0,chartCaption:"",pdfTextFontFamily:"Helvetica",pdfTitleFontSize:20,pdfCaptionFontSize:14},onDone:null},i&&i.originalHeight&&i.originalWidth?(this._options.originalHeight=i.originalHeight,this._options.originalWidth=i.originalWidth):(this._options.originalHeight=-1!==t.style.getPropertyValue("height").indexOf("%")||t.getAttribute("height")&&-1!==t.getAttribute("height").indexOf("%")?t.getBBox().height:t.getBoundingClientRect().height,this._options.originalWidth=-1!==t.style.getPropertyValue("width").indexOf("%")||t.getAttribute("width")&&-1!==t.getAttribute("width").indexOf("%")?t.getBBox().width:t.getBoundingClientRect().width);const o=t.getAttribute("viewBox");if(o){var e,s,n,p;const t=o.split(/[\s,]+/);this._options.originalMinXViewBox=null!=(e=t[0])?e:0,this._options.originalMinYViewBox=null!=(s=t[1])?s:0,this._options.originalWidthViewbox=null!=(n=t[2])?n:100,this._options.originalHeightViewbox=null!=(p=t[3])?p:100}else this._options.originalMinXViewBox=0,this._options.originalMinYViewBox=0,this._options.originalWidthViewbox=NaN,this._options.originalHeightViewbox=NaN;i&&i.scale&&"number"==typeof i.scale&&(this._options.scale=i.scale),i&&i.height?"number"==typeof i.height&&(this._options.height=i.height*this._options.scale):this._options.height=this._options.originalHeight*this._options.scale,i&&i.width?"number"==typeof i.width&&(this._options.width=i.width*this._options.scale):this._options.width=this._options.originalWidth*this._options.scale,i&&!1===i.useCSS&&(this._options.useCSS=!1),i&&i.transparentBackgroundReplace&&(this._options.transparentBackgroundReplace=i.transparentBackgroundReplace),i&&i.allowCrossOriginImages&&(this._options.allowCrossOriginImages=i.allowCrossOriginImages),i&&i.excludeByCSSSelector&&"string"==typeof i.excludeByCSSSelector&&(this._options.elementsToExclude=t.querySelectorAll(i.excludeByCSSSelector)),i&&i.onDone&&"function"==typeof i.onDone&&(this._options.onDone=i.onDone),i&&i.svgTextToPathSettings&&(this._options.svgTextToPathSettings=i.svgTextToPathSettings),i&&i.convertTextToPath&&(this._options.convertTextToPath=i.convertTextToPath),this._setPdfOptions(i)}useCSSfromComputedStyles(t,i){if("function"!=typeof getComputedStyle)return void this._warnError("Warning svg-export: this browser is not able to get computed styles");for(let t=0;t<this._options.elementsToExclude.length;t++)if(this._options.elementsToExclude[t]===i)return;let o=window.getComputedStyle(t);if(o.length>0)for(const t of o)-1===["width","height","inline-size","block-size"].indexOf(t)&&i.style.setProperty(t,o.getPropertyValue(t));t.childNodes.forEach((t,o)=>{1===t.nodeType&&this.useCSSfromComputedStyles(t,i.childNodes[parseInt(o,10)])})}setupSvg(t,i,o){void 0===o&&(o=!0),this._options.useCSS&&"object"==typeof i&&(this.useCSSfromComputedStyles(i,t),t.style.display=null),this._options.elementsToExclude.forEach(t=>{t.remove()}),t.style.width=null,t.style.height=null,t.setAttribute("width",this._options.width),t.setAttribute("height",this._options.height),t.setAttribute("preserveAspectRatio","none"),t.setAttribute("viewBox",this._options.originalMinXViewBox+" "+this._options.originalMinYViewBox+" "+(isNaN(this._options.originalWidthViewbox)?this._options.originalWidth:this._options.originalWidthViewbox)+" "+(isNaN(this._options.originalHeightViewbox)?this._options.originalHeight:this._options.originalHeightViewbox));let e=document.getElementsByClassName("tempdiv-svg-exportJS");for(;e.length>0;)e[0].parentNode.removeChild(e[0]);if(o){let i=(new XMLSerializer).serializeToString(t).replace(/currentColor/g,"black");return i.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(i=i.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),i.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(i=i.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),i}return t}convertImageURLtoDataURI(t){const i=this;return new Promise((o,e)=>{const s=new Image;s.onload=()=>{const i=document.createElement("canvas");i.width=s.naturalWidth||s.getAttribute("width")||s.style.getPropertyValue("width")||300,i.height=s.naturalHeight||s.getAttribute("height")||s.style.getPropertyValue("height")||300,i.getContext("2d").drawImage(s,0,0);const e=i.toDataURL("image/png");t.setAttribute("href",e),o()},i._options.allowCrossOriginImages&&(s.crossOrigin="anonymous"),s.src=t.getAttribute("href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")})}getCustomFonts(t){let i=[];return t.forEach(t=>{let o=new Promise((i,o)=>{let e=new XMLHttpRequest;e.onreadystatechange=()=>{4===e.readyState&&200===e.status&&i(e.response)},e.open("GET",t,!0),e.responseType="arraybuffer",e.send(null)});i.push(o)}),i}triggerDownload(t,i,o){if(i=i.replace(/[/\\?%*:|"<>]/g,"_"),navigator.msSaveBlob){let e=decodeURIComponent(t.split(",")[1]),s=[],n=t.split(",")[0].split(":")[1].split(";")[0];for(let t=0;t<e.length;t++)s.push(e.charCodeAt(t));let p=null;p=null!=o?o.msToBlob():new Blob([new Uint8Array(s)],{type:n}),navigator.msSaveBlob(p,i)}else{let o=document.createElement("a");o.download=i,o.href=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}this._options.onDone&&this._options.onDone()}downloadSvg(t,i,o){null==i&&(i="chart");const e=()=>{const e=this._getSvgElement(t);if(!e)return;this._setOptions(e,o);const s=e.getElementsByTagName("image"),n=[];if(s)for(let t of s)(t.getAttribute("href")&&-1===t.getAttribute("href").indexOf("data:")||t.getAttribute("xlink:href")&&-1===t.getAttribute("xlink:href").indexOf("data:"))&&n.push(this.convertImageURLtoDataURI(t));Promise.all(n).then(()=>{let o=this.setupSvg(e,t);o='<?xml version="1.0" standalone="no"?>\r\n'+o;let s="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(o);this.triggerDownload(s,i+".svg")})};if(o.convertTextToPath){const i=new this._textToPath(t,o.svgTextToPathSettings);i.replaceAll().then(()=>{e(),i.destroy()})}else e()}async downloadRaster(t,i,o,e){if(!this._hasCanvg)return void this._warnError("Error svg-export: PNG/JPEG export requires Canvg. Install it via npm or include it via script tag.");"png"!==(e=e.toLowerCase().replace("jpg","jpeg"))&&"jpeg"!==e&&(e="png");const s=this._getSvgElement(t);if(!s)return;null==i&&(i="chart"),o||(o={}),this._setOptions(s,o);let n=this.setupSvg(s,t);"jpeg"===e&&(n=n.replace(">",'><rect x="0" y="0" width="'+this._options.width+'" height="'+this._options.height+'" fill="'+this._options.transparentBackgroundReplace+'"/>')),n=this.removeBreakingStyles(n);let p=new OffscreenCanvas(this._options.width,this._options.height);const a=this._presets.offscreen();a.anonymousCrossOrigin=this._options.allowCrossOriginImages;let r=p.getContext("2d"),h=this._canvg.fromString(r,n,a);h.start(),h.ready().then(()=>{p.convertToBlob({type:"jpeg"===e?"image/jpeg":"image/png"}).then(t=>{const o=URL.createObjectURL(t);this.triggerDownload(o,i+"."+e,p)})})}removeBreakingStyles(t){return t.replace(/mask: none; mask-type: luminance;/g,"")}downloadPng(t,i,o){this.downloadRaster(t,i,o,"png")}downloadJpeg(t,i,o){this.downloadRaster(t,i,o,"jpeg")}fillPDFDoc(t,i,o){this._options.pdfOptions.addTitleToPage&&t.font(this._options.pdfOptions.pdfTextFontFamily).fontSize(this._options.pdfOptions.pdfTitleFontSize).text(i,{width:this._options.pdfOptions.pageLayout.size[0]-this._options.pdfOptions.pageLayout.margins.left-this._options.pdfOptions.pageLayout.margins.right}),this._svgToPdf(t,o,this._options.pdfOptions.pageLayout.margins.left,t.y+10,{width:this._options.width,height:this._options.height,preserveAspectRatio:"none",useCSS:this._options.useCSS}),""!==this._options.pdfOptions.chartCaption&&t.font(this._options.pdfOptions.pdfTextFontFamily).fontSize(this._options.pdfOptions.pdfCaptionFontSize).text(this._options.pdfOptions.chartCaption,this._options.pdfOptions.pageLayout.margins.left,this._options.pdfOptions.pageLayout.size[1]-this._options.pdfOptions.pageLayout.margins.bottom-4*this._options.pdfOptions.pdfCaptionFontSize,{width:this._options.pdfOptions.pageLayout.size[0]-this._options.pdfOptions.pageLayout.margins.left-this._options.pdfOptions.pageLayout.margins.right})}downloadPdf(t,i,o){if(!this._hasPDF)return void this._warnError("Error svg-export: PDF export requires PDFKit, blob-stream and SVG-to-PDFKit.");const e=this._getSvgElement(t);if(!e)return;null==i&&(i="chart"),this._setOptions(e,o);const s=this.setupSvg(e,t,!1),n=new this._pdfkit(this._options.pdfOptions.pageLayout),p=n.pipe(this._blobStream());let a=e.getElementsByTagName("image"),r=[];if(a)for(let t of a)(t.getAttribute("href")&&-1===t.getAttribute("href").indexOf("data:")||t.getAttribute("xlink:href")&&-1===t.getAttribute("xlink:href").indexOf("data:"))&&r.push(this.convertImageURLtoDataURI(t));Promise.all(r).then(()=>{if(this._options.pdfOptions.customFonts.length>0){let t=this.getCustomFonts(this._options.pdfOptions.customFonts.map(t=>t.url));Promise.all(t).then(t=>{t.forEach((t,i)=>{let o=this._options.pdfOptions.customFonts[parseInt(i,10)];s.querySelectorAll('[style*="'+o.fontName+'"]').forEach(t=>{t.style.fontFamily=o.fontName}),-1===o.url.indexOf(".ttc")&&-1===o.url.indexOf(".dfont")||!o.styleName?n.registerFont(o.fontName,t):n.registerFont(o.fontName,t,o.styleName)}),this.fillPDFDoc(n,i,s),n.end()})}else this.fillPDFDoc(n,i,s),n.end()}),p.on("finish",()=>{let t=p.toBlobURL("application/pdf");this.triggerDownload(t,i+".pdf")})}}"object"==typeof exports&&"undefined"!=typeof module?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):("undefined"!=typeof globalThis?globalThis:self).SvgExport=t;export{t as default};
//# sourceMappingURL=svg-export.modern.js.map
